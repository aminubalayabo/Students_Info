<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Student Results Summary</title>  
    <style>  
        body {  
            font-family: Arial, sans-serif;  
        }  
        table {  
            border-collapse: collapse;  
            width: 100%;  
            margin-top: 20px;  
        }  
        th, td {  
            border: 1px solid #ddd;  
            padding: 8px;  
        }  
        th {  
            background-color: #f2f2f2;  
        }  
    </style>  
</head>  
<body>  

<h1>Student Results Summary</h1>  

<h2>Search by Admission Number</h2>  
<input type="text" id="admissionNumber" placeholder="Enter Admission Number">  
<button onclick="searchByAdmissionNumber()">Search</button>  

<h2>Filter by Department</h2>  
<select id="departmentSelect">  
    <option value="">Select Department</option>  
    <option value="ACCOUNTING">Accounting</option>  
    <option value="ECONOMICS">Economics</option>  
    <option value="ZOOLOGY">Zoology</option>  
</select>  
<button onclick="filterByDepartment()">Filter</button>  

<div id="results"></div>  

<script>  
    const url = 'https://raw.githubusercontent.com/aminubalayabo/Students_Info/main/Student_Details/Details.txt';  

    async function fetchStudentData() {  
        const response = await fetch(url);  
        const data = await response.text();  
        return parseData(data);  
    }  

    function parseData(data) {  
        const lines = data.trim().split('\n');  
        const header = lines[0].split(',');  
        const students = lines.slice(1).map(line => {  
            const values = line.split(',');  
            const student = {};  
            header.forEach((h, i) => {  
                student[h.trim()] = values[i].trim();  
            });  
            return student;  
        });  
        return students;  
    }  

    function searchByAdmissionNumber() {  
        const admissionNumber = document.getElementById("admissionNumber").value.trim();  
        if (admissionNumber) {  
            fetchStudentData().then(students => {  
                const results = students.filter(student => student.AdmNo === admissionNumber);  
                displayResults(results);  
            });  
        }  
    }  

    function filterByDepartment() {  
        const department = document.getElementById("departmentSelect").value;  
        if (department) {  
            fetchStudentData().then(students => {  
                const results = students.filter(student => student.Department === department);  
                displayDepartmentResults(results);  
            });  
        }  
    }  

    function displayResults(results) {  
        if (results.length === 0) {  
            document.getElementById('results').innerHTML = 'No results found.';  
            return;  
        }  

        const groupedResults = results.reduce((acc, student) => {  
            const session = student.Session;  
            if (!acc[session]) {  
                acc[session] = [];  
            }  
            acc[session].push(student);  
            return acc;  
        }, {});  

        let output = '';  
        for (const session in groupedResults) {  
            output += `<h3>Results for Session: ${session}</h3>`;  
            output += `<table>  
                <tr>  
                    <th>AdmissionNumber</th>  
                    <th>Course</th>  
                    <th>Units</th>  
                    <th>CA</th>  
                    <th>Exam</th>  
                    <th>Total Score</th>  
                    <th>Grade</th</th>  
                    <th>Grade Points</th>  
                </tr>`;  

            let totalUnits = 0;  
            let totalGradePoints = 0;  
            let totalScoreSum = 0;  

            groupedResults[session].forEach(student => {  
                const totalScore = parseInt(student.CA) + parseInt(student.Exam);  
                const gradeInfo = getGrade(totalScore);  

                totalUnits += parseInt(student.UNTS);  
                totalGradePoints += (gradeInfo.point * parseInt(student.UNTS));  
                totalScoreSum += totalScore;  
                output += `<tr>  
                    <td>${student.AdmNo}</td>  
                    <td>${student.Course}</td>  
                    <td>${student.UNTS}</td>  
                    <td>${student.CA}</td>  
                    <td>${student.Exam}</td>  
                    <td>${totalScore}</td>  
                    <td>${gradeInfo.grade}</td>  
                    <td>${(gradeInfo.point * parseInt(student.UNTS)).toFixed(2)}</td>  
                </tr>`;  
            });  

            const gpa = (totalGradePoints / totalUnits).toFixed(2) || 0;  
            output += `</table><h4>Total Units: ${totalUnits}</h4><h4>GPA: ${gpa}</h4>`;  
        }  

        document.getElementById('results').innerHTML = output;  
    }  

    function displayDepartmentResults(results) {  
        if (results.length === 0) {  
            document.getElementById('results').innerHTML = 'No results found for this department.';  
            return;  
        }  

        const groupedById = results.reduce((acc, student) => {  
            if (!acc[student.AdmNo]) {  
                acc[student.AdmNo] = {  
                    Name: student.Name,  
                    Department: student.Department,  
                    Courses: [],  
                    TotalUnits: 0,  
                    TotalGradePoints: 0,  
                    TotalScores: 0  
                };  
            }  

            const totalScore = parseInt(student.CA) + parseInt(student.Exam);  
            const gradeInfo = getGrade(totalScore);  

            acc[student.AdmNo].Courses.push({  
                Course: student.Course,  
                UNTS: student.UNTS,  
                CA: student.CA,  
                Exam: student
