<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial, sans-serif; }
      .container { max-width: 700px; margin: 0 auto; padding: 20px; }
      input, button { display: block; width: 30%; margin-bottom: 10px; padding: 5px; }
      /* #loginForm, #registerForm, #opinionForm { display: block; } */
      #loginForm { display: block; }
      #opinionForm { display: none; }
    </style>
  </head>
  <body>
    <div class="container">
      
     
      <!-- <button onclick="showLogin()">Login</button> -->
     
      <div id="loginForm">
        <h2>Login To View Your Results</h2>
        <input type="text" id="loginUsername" placeholder="Username" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button onclick="login()">Login</button>
        
      </div>
      
      

    
    <script>
  var currentUser = '';
  
  function showLogin() {
    
    document.getElementById('loginForm').style.display = 'block';
  }
  
 
  
  function login() {
    var username = document.getElementById('loginUsername').value;
    var password = document.getElementById('loginPassword').value;
    
    if (username === '' || password === '') {
      window.alert('Please Fill Out All Fields');
    return;
  }

   
            





    google.script.run.withSuccessHandler(function(result) {
      if (result === 'success') {
        currentUser = username;
       window.location.href = 'https://script.google.com/macros/s/AKfycbyTdTwAx4JthXdwIUKSAbiuRCGGk5Vr4r2vFMhIhNeutyfqr7wCl7ScG2ix5WsWOvTMrA/exec';  
        
        
        
        // Clear input boxes
        document.getElementById('loginUsername').value = '';
        document.getElementById('loginPassword').value = '';
      } else {
        alert(result);
      }
    }).loginUserV(username, password);
    
  
  }
  
 
  
  
</script>
<Script>
    function doGet() {
  return HtmlService.createHtmlOutputFromFile('ViewResults')
    .setTitle('SOBAS RESULTS 2023/2024');
}

function validateUser(username, password) {  
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Sheet5');  
  const data = sheet.getDataRange().getValues();  
  
  for (let i = 1; i < data.length; i++) { // Start from 1 to skip header  
    if (data[i][1] === username && data[i][2] === password) {  
      return true; // User found  
    }  
  }  
  return false; // User not found  
}




function loginUserV(username, password) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Sheet3');
  var data = sheet.getDataRange().getValues();
  //SET USERNAME IN RANGE K1
  sheet.getRange("K1").setValue(username);
  sheet.getRange("K2").getValue;
  for (var i = 1; i < data.length; i++) {
    if (data[i][1] == username && data[i][2] == password) {
      if (data[i][3] !== '') {
        return 'You have already submitted your Score.';
      }
      return 'success';
    }
  }
  
  return 'Invalid username or password.';
}


</Script>    
    
  </body>
</html>